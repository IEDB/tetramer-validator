<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Tetramer Validator</title>
  <script src="{{url_for('static', filename='jquery-3.5.1.min.js')}}"> </script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
  <script type="text/javascript" src="{{url_for('static', filename='typeahead.bundle.min.js')}}"> </script>
  <link rel="stylesheet" href="{{url_for('static', filename='typeaheadjs.css')}}" />
  <link rel="stylesheet" href="{{url_for('static', filename='bootstrap-tokenfield.min.css')}}" />
  <script type="text/javascript" src="{{url_for('static', filename='bootstrap-tokenfield.min.js')}}"> </script>
</head>

<body>
<h1> Tetramer Validator </h1>
<div class="forms">
  <div class="container-fluid">
    <form method="POST" class="form-horizontal" action="{{url_for('output')}}">
      <div class="form-row center-block" id="0">
        <div class="col mhc_name">
          <label for="MHC Molecule">MHC Molecule
            <span>
              <svg tabindex="0" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-question" data-toggle="popover" data-trigger="focus" data-content="Enter MHC molecule from prepopulated list. Click <a href='{{(url_for('readme'))}}'> here </a> for documentation" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
              </svg>
            </span>
          </label>
          <div class="special">
          <input name="mhc_name" type="text" class="twitter-typeahead form-control mhc_name" placeholder="Example: HLA-A*02:01" autocomplete="off" required>
        </div>
        </div>
        <div class="col pep_seq">
          <label for="Peptide Sequence">Peptide Sequence
            <span>
              <svg tabindex="0" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-question" data-toggle="popover" data-trigger="focus" data-content="Enter valid amino acid sequence. Click <a href='{{(url_for('readme'))}}'> here </a> for documentation" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
              </svg>
            </span>
          </label>
          <input name="pep_seq" type="text" class="form-control pep_seq" placeholder="Example: NLVPMVATV" required>

        </div>
        <div class="col mod_type">
          <label for="Modification Type">Modification Type
            <span>
              <svg tabindex="0" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-question" data-toggle="popover" data-trigger="focus" data-content="Please choose a post-translational type from the prepopulated list. Click <a href='{{(url_for('readme'))}}'> here </a> for documentation" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
              </svg>
            </span>
          </label>
          <input name="mod_type" type="text" class="twitter-typeahead form-control mod_type" autocomplete="off" spellcheck="false" placeholder="Example: oxidized residue">
        </div>
        <div class="col mod_pos">
          <label for="Modification Position">Modification Position
            <span>
              <svg tabindex="0" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-question" data-toggle="popover" data-trigger="focus" data-content="Enter a amino acid letter and matching position from peptide sequence. Modification Position field should be a comma separated list of amino acid letter followed by position number (e.g. F1, S10, S300). Click <a href='{{(url_for('readme'))}}'> here </a> for documentation" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
              </svg>
            </span>
          </label>
          <input name="mod_pos" type="text" class="form-control mod_pos" placeholder="Example: M5">
        </div>
      </div>
      <div class="post-action 0">
      <p> </p>
      </div>
      <style>
        .form-actions {
          margin: 10px;
          text-align: center;
        }
      </style>
      <script type="text/javascript" src="{{url_for('static', filename='form_submit.js')}}" > </script>
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Submit</button>
      </div>

    </form>

</div>
<button class="btn btn-secondary" id="Add"> Add tetramer/multimer </button>
<button class="btn btn-secondary" id="Clear"> Clear </button>
<div class="container-fluid" id="form-info">
  <div class="alert alert-info" role="alert">
    <p> <a href="{{url_for('readme')}}"> Documentation </a> </p>
    <p> <a href="?mhc_name=HLA-B*07%3A04&pep_seq=AARPATSTL&mod_type=&mod_pos="> Example without modification </a> </p>
    <p> <a href="?mhc_name=HLA-DRB1*04%3A06&pep_seq=MIVIL&mod_type=formylated+residue&mod_pos=M1"> Example with modification </a> </p>
  </div>
</div>
<script type="text/javascript" src="{{url_for('static', filename='form.js')}}" > </script>
<script type="text/javascript" src="{{url_for('static', filename='MHC_display.js')}}"> </script>
<script type="text/javascript" src="{{url_for('static', filename='PTM_display.js')}}"> </script>
{% set fish=input["mhc_name"]|length %}
{% if list %}
{% for inp in range(fish -1) %}
 <script>
 $("#Add").trigger("click");
</script>
{% endfor %}

{% for inp in range(fish) %}
<script type="text/javascript">

$("#{{inp}} .mhc_name input").val("{{input["mhc_name"][inp]}}");
$("#{{inp}} .pep_seq input").val("{{input["pep_seq"][inp]}}");
var select = "#{{inp}} .mod_type input";
$("#".concat("{{inp}}", " .mod_type input")).tokenfield('setTokens', "{{input["mod_type"][inp]}}");
$("#".concat("{{inp}}", " .mod_pos input")).val("{{input["mod_pos"][inp]}}");
</script>
{% if errors[inp] %}
<script>

$(".{{inp}}").append("<ul class='{{inp}}'> <p> Errors </p> </ul>");
 $(".{{inp}} ul").addClass('alert');
  $(".{{inp}} ul").addClass('alert-danger');
  $(".{{inp}} ul").attr("role",'alert');
  {% for error in errors[inp] %}

    {% set message = error["message"] %}
    {% if error["suggestion"] %}
    {% set message = message + " Suggested fix is " + error["suggestion"] + "." %}
    {% endif %}
      $(".{{inp}} ul").append("<li> {{message}} </li>");
      field_error_highlight("#{{inp}} .{{error['field']}}");
  {% endfor %}
removePlaceholders("#{{inp}}");

  </script>

{% else %}
<script>
  $(".{{inp}}").append("<p class='alert alert-success' role='alert'> Success! Input is valid </p>");
  field_success_highlight("#{{inp}}");
</script>
{% endif %}
{% endfor %}
<script type="text/javascript">
var tokens_zero = $("#0 .mod_type input").tokenfield('getTokens');
$("#0 .mod_type input").tokenfield('destroy');
newPTMTypeahead("#0");
$("#0 .mod_type input").tokenfield('setTokens', tokens_zero);
</script>
<p> <a href="{{url_for('download_input', filename= input_filepath)}}"> Click here to export all of your input </a> </p>
{% endif %}
</div>

</body>

</html>
